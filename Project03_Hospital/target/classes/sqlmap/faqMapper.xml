<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hospital.mapper.FaqMapper">

	<!-- 전체 조회 -->
	<select id="getAllFaq" resultType="com.hospital.vo.FaqVO">
		SELECT * FROM hospital_faq ORDER BY created_at DESC
	</select>

	<!-- 카테고리별 조회 -->
	<select id="getFaqByCategory" resultType="com.hospital.vo.FaqVO">
		SELECT * FROM hospital_faq
		WHERE category = #{category}
		ORDER BY created_at DESC
	</select>

	<!-- 키워드 검색 -->
	<select id="searchFaq" resultType="com.hospital.vo.FaqVO">
		SELECT * FROM hospital_faq
		WHERE question LIKE '%' || #{keyword} || '%'
		OR answer LIKE '%' || #{keyword} || '%'
		ORDER BY created_at DESC
	</select>

	<!-- 등록 -->
	<insert id="insertFaq">
		INSERT INTO hospital_faq (
		faq_id, category, question, answer
		) VALUES (
		seq_hospital_faq.NEXTVAL,
		#{category},
		#{question},
		#{answer}
		)
	</insert>

	<!-- ID로 조회 -->
	<select id="getFaqById" resultType="com.hospital.vo.FaqVO">
		SELECT * FROM hospital_faq WHERE faq_id = #{faqId}
	</select>

	<!-- 수정 -->
	<update id="updateFaq">
		UPDATE hospital_faq
		SET category = #{category},
		question = #{question},
		answer = #{answer}
		WHERE faq_id = #{faqId}
	</update>

	<delete id="deleteFaq" parameterType="int">
		DELETE FROM hospital_faq WHERE faq_id = #{faqId}
	</delete>


	<!-- ✅ 전체 개수 -->
	<select id="getFaqCount" resultType="int">
		SELECT COUNT(*) FROM hospital_faq
		<where>
			<if test="category != null and category != ''">
				AND category = #{category}
			</if>
			<if test="keyword != null and keyword != ''">
				AND question LIKE '%' || #{keyword} || '%'
			</if>
		</where>
	</select>

	<!-- ✅ 페이징 목록 조회 -->
	<select id="getFaqList" resultType="com.hospital.vo.FaqVO">
		SELECT * FROM (
		SELECT ROWNUM rn, A.* FROM (
		SELECT * FROM hospital_faq
		<where>
			<if test="category != null and category != ''"> AND category = #{category} </if>
			<if test="keyword != null and keyword != ''"> AND question LIKE '%' || #{keyword} || '%' </if>
		</where>
		ORDER BY faq_id DESC
		) A
		WHERE ROWNUM &lt;= #{start} + #{pageSize}
		)
		WHERE rn &gt; #{start}
	</select>

</mapper>


<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hospital.dao.MedicalNoticeDAO">

	<!-- ResultMap for MedicalNotice with Admin Name -->
	<resultMap id="MedicalNoticeResultMap"
		type="com.hospital.vo.MedicalNoticeVO">
		<result property="noticeId" column="notice_id" />
		<result property="title" column="title" />
		<result property="content" column="content" />
		<result property="targetRole" column="target_role" />
		<result property="createdBy" column="created_by" />
		<result property="createdAt" column="created_at" />
		<result property="adminName" column="admin_name" /> <!-- 작성자 이름 -->
	</resultMap>

	<!-- 목록 조회 (JOIN) -->
	<select id="getAllMedicalNotices"
		resultMap="MedicalNoticeResultMap">
		SELECT mn.notice_id, mn.title, mn.target_role,
		mn.created_by, mn.created_at, a.name AS admin_name
		FROM medical_notices
		mn
		JOIN admins a ON mn.created_by = a.admin_id
		ORDER BY mn.created_at
		DESC
	</select>

	<!-- 상세 조회 (JOIN) -->
	<select id="getMedicalNoticeById" parameterType="int"
		resultMap="MedicalNoticeResultMap">
		SELECT mn.notice_id, mn.title, mn.content, mn.target_role,
		mn.created_by, mn.created_at, a.name AS admin_name
		FROM medical_notices
		mn
		JOIN admins a ON mn.created_by = a.admin_id
		WHERE mn.notice_id =
		#{noticeId}
	</select>

	<!-- INSERT (ID는 admin_id로 저장) -->
	<insert id="insertMedicalNotice"
		parameterType="com.hospital.vo.MedicalNoticeVO">
		INSERT INTO medical_notices (notice_id, title, content,
		target_role, created_by, created_at)
		VALUES
		(SEQ_MEDICAL_NOTICE_ID.NEXTVAL, #{title}, #{content}, #{targetRole},
		#{createdBy}, SYSDATE)
	</insert>

	<!-- UPDATE -->
	<update id="updateMedicalNotice"
		parameterType="com.hospital.vo.MedicalNoticeVO">
		UPDATE medical_notices
		SET title = #{title}, content =
		#{content}, target_role = #{targetRole}
		WHERE notice_id = #{noticeId}
	</update>

	<!-- DELETE -->
	<delete id="deleteMedicalNotice" parameterType="int">
		DELETE FROM
		medical_notices WHERE notice_id = #{noticeId}
	</delete>

</mapper>

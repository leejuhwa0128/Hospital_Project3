<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hospital.dao.RecordDAO">

	<!-- 특정 환자의 진료기록 조회 -->
	<select id="getRecordsByPatientNo" parameterType="int"
		resultType="com.hospital.vo.MedicalRecordVO">
		SELECT
		mr.record_id,
		mr.reservation_id,
		r.patient_no,
		mr.doctor_id,
		mr.record_date,
		mr.diagnosis,
		mr.treatment,
		mr.prescription,
		u.name AS doctor_name,
		d.name AS department_name
		FROM medical_records mr
		JOIN reservations r ON mr.reservation_id = r.reservation_id
		JOIN users u ON mr.doctor_id = u.user_id
		JOIN doctor_info di ON mr.doctor_id = di.doctor_id
		LEFT JOIN departments d ON di.dept_id = d.dept_id
		WHERE r.patient_no = #{patientNo}
		ORDER BY mr.record_date DESC
	</select>

</mapper>
